<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DentalVerify — POC Prototype</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0A0E17; --surface: #111827; --surface-hover: #1a2236;
    --card: #151d2e; --card-hover: #1c2640;
    --border: #1e293b; --border-active: #3b82f6;
    --text: #e2e8f0; --text-muted: #94a3b8; --text-dim: #64748b;
    --accent: #3b82f6; --accent-glow: rgba(59,130,246,0.15);
    --success: #10b981; --success-bg: rgba(16,185,129,0.1);
    --warning: #f59e0b; --warning-bg: rgba(245,158,11,0.1);
    --danger: #ef4444; --danger-bg: rgba(239,68,68,0.1);
    --purple: #8b5cf6; --purple-bg: rgba(139,92,246,0.1);
    --cyan: #06b6d4; --cyan-bg: rgba(6,182,212,0.1);
    --font: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    --mono: 'JetBrains Mono', 'Fira Code', monospace;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: var(--font); background: var(--bg); color: var(--text); display: flex; min-height: 100vh; overflow: hidden; }

  /* Sidebar */
  .sidebar { width: 240px; background: var(--surface); border-right: 1px solid var(--border); padding: 20px 12px; display: flex; flex-direction: column; flex-shrink: 0; height: 100vh; }
  .logo { display: flex; align-items: center; gap: 10px; padding: 8px 12px; margin-bottom: 28px; }
  .logo-icon { width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, var(--accent), var(--purple)); display: flex; align-items: center; justify-content: center; }
  .logo-text { font-size: 15px; font-weight: 800; letter-spacing: -0.02em; }
  .logo-sub { font-size: 10px; color: var(--text-dim); font-weight: 600; letter-spacing: 0.06em; }
  .nav-label { font-size: 10px; font-weight: 700; color: var(--text-dim); padding: 0 12px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.1em; }
  .nav-btn { display: flex; align-items: center; gap: 10px; width: 100%; padding: 10px 12px; border-radius: 10px; border: none; background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600; cursor: pointer; font-family: var(--font); text-align: left; transition: all 0.15s; margin-bottom: 2px; }
  .nav-btn:hover { background: var(--surface-hover); }
  .nav-btn.active { background: var(--accent-glow); color: var(--accent); }
  .nav-btn .persona { font-size: 10px; color: var(--text-dim); font-weight: 500; }
  .sidebar-footer { margin-top: auto; padding: 12px; border-top: 1px solid var(--border); font-size: 11px; color: var(--text-dim); line-height: 1.5; }

  /* Main */
  .main { flex: 1; padding: 28px 36px; overflow-y: auto; height: 100vh; }
  .main-inner { max-width: 1000px; margin: 0 auto; }
  .breadcrumb { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; font-size: 12px; color: var(--text-dim); }
  .page-title { font-size: 26px; font-weight: 800; letter-spacing: -0.02em; margin-bottom: 24px; }

  /* Shared */
  .badge { display: inline-flex; align-items: center; gap: 4px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; letter-spacing: 0.02em; }
  .badge.sm { padding: 2px 8px; font-size: 11px; }
  .status-dot { display: flex; align-items: center; gap: 6px; font-size: 12px; font-weight: 600; }
  .status-dot .dot { width: 8px; height: 8px; border-radius: 50%; }

  .progress-wrap { width: 100%; }
  .progress-label { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 12px; }
  .progress-bar { height: 6px; background: var(--border); border-radius: 3px; overflow: hidden; }
  .progress-fill { height: 100%; border-radius: 3px; transition: width 0.8s cubic-bezier(0.4,0,0.2,1); }

  /* Stats */
  .stats-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin-bottom: 24px; }
  .stat-card { border-radius: 12px; padding: 14px 16px; cursor: pointer; transition: all 0.2s; border: 1px solid var(--border); background: var(--surface); }
  .stat-card.active { border-color: color-mix(in srgb, currentColor, transparent 60%); }
  .stat-num { font-size: 28px; font-weight: 700; font-family: var(--mono); }
  .stat-label { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

  /* Search bar */
  .search-bar { display: flex; gap: 12px; margin-bottom: 20px; }
  .search-input { flex: 1; display: flex; align-items: center; gap: 8px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 0 14px; }
  .search-input input { flex: 1; background: none; border: none; outline: none; color: var(--text); font-size: 14px; font-family: var(--font); padding: 12px 0; }
  .btn-primary { display: flex; align-items: center; gap: 8px; padding: 0 20px; background: linear-gradient(135deg, var(--accent), #2563eb); border: none; border-radius: 10px; color: #fff; font-size: 13px; font-weight: 600; cursor: pointer; font-family: var(--font); }
  .btn-primary:hover { filter: brightness(1.1); }
  .btn-outline { display: flex; align-items: center; gap: 6px; background: none; border: 1px solid color-mix(in srgb, var(--accent), transparent 60%); border-radius: 8px; padding: 6px 14px; color: var(--accent); font-size: 12px; font-weight: 600; cursor: pointer; font-family: var(--font); }

  /* Table */
  .data-table { background: var(--surface); border-radius: 14px; border: 1px solid var(--border); overflow: hidden; }
  .data-table table { width: 100%; border-collapse: collapse; }
  .data-table th { padding: 12px 16px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.06em; border-bottom: 1px solid var(--border); }
  .data-table td { padding: 14px 16px; font-size: 13px; }
  .data-table tbody tr { border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.15s; }
  .data-table tbody tr:last-child { border-bottom: none; }
  .data-table tbody tr:hover { background: var(--surface-hover); }
  .code-tag { font-size: 12px; font-family: var(--mono); padding: 3px 8px; border-radius: 6px; }

  /* Cards */
  .card { background: var(--surface); border-radius: 14px; border: 1px solid var(--border); padding: 20px; }
  .card-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; }
  .cards-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; margin-bottom: 24px; }

  /* Tabs */
  .tabs { display: flex; gap: 4px; margin-bottom: 20px; }
  .tab-btn { padding: 10px 20px; border-radius: 10px; border: none; background: transparent; color: var(--text-muted); font-size: 13px; font-weight: 600; cursor: pointer; font-family: var(--font); transition: all 0.2s; }
  .tab-btn.active { background: var(--accent); color: #fff; }

  /* Coverage table */
  .cov-grid { display: grid; grid-template-columns: 1fr 100px 80px 80px 1fr; gap: 12px; align-items: center; padding: 14px 0; border-bottom: 1px solid var(--border); }
  .cov-header { font-size: 11px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.06em; border-bottom: 2px solid var(--border); padding: 12px 0; }
  .proc-grid { display: grid; grid-template-columns: 80px 1fr 60px 50px 80px 80px 80px 80px; gap: 8px; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
  .proc-header { border-bottom: 2px solid var(--border); padding: 12px 0; }

  /* Alert note */
  .alert-note { display: flex; gap: 12px; padding: 14px; border-radius: 10px; font-size: 13px; line-height: 1.5; }

  /* Preauth kanban */
  .kanban { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 24px; }
  .kanban-col { background: var(--surface); border-radius: 14px; border: 1px solid var(--border); overflow: hidden; }
  .kanban-header { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; }
  .kanban-body { padding: 10px; display: flex; flex-direction: column; gap: 8px; min-height: 100px; }
  .kanban-card { background: var(--card); border-radius: 10px; padding: 12px; border: 1px solid var(--border); cursor: pointer; transition: all 0.15s; }
  .kanban-card:hover { background: var(--card-hover); }
  .count-bubble { width: 22px; height: 22px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; }

  /* Patient estimate */
  .estimate-center { max-width: 560px; margin: 0 auto; }
  .estimate-header { text-align: center; margin-bottom: 32px; background: linear-gradient(135deg, rgba(59,130,246,0.07), rgba(139,92,246,0.07)); border-radius: 20px; padding: 32px 24px; border: 1px solid rgba(59,130,246,0.13); }
  .avatar { width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, var(--accent), var(--purple)); display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 24px; font-weight: 700; color: #fff; }
  .big-number { font-size: 52px; font-weight: 800; font-family: var(--mono); margin-top: 8px; background: linear-gradient(135deg, var(--text), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
  .payment-opt { display: flex; justify-content: space-between; align-items: center; padding: 14px; border-radius: 10px; margin-bottom: 8px; cursor: pointer; border: 1px solid var(--border); background: var(--bg); }
  .payment-opt.highlight { background: var(--accent-glow); border-color: rgba(59,130,246,0.25); }
  .cta-btn { width: 100%; padding: 16px; border-radius: 14px; border: none; background: linear-gradient(135deg, var(--accent), #2563eb); color: #fff; font-size: 16px; font-weight: 700; cursor: pointer; font-family: var(--font); box-shadow: 0 4px 20px rgba(59,130,246,0.25); }

  /* Card capture */
  .capture-center { max-width: 480px; margin: 0 auto; }
  .step-progress { display: flex; gap: 4px; margin-bottom: 32px; }
  .step-bar { flex: 1; text-align: center; }
  .step-bar .bar { height: 3px; border-radius: 2px; margin-bottom: 8px; background: var(--border); transition: background 0.3s; }
  .step-bar .bar.active { background: var(--accent); }
  .step-bar span { font-size: 11px; font-weight: 600; color: var(--text-dim); }
  .step-bar span.active { color: var(--accent); }
  .capture-zone { background: var(--surface); border-radius: 20px; border: 2px dashed rgba(59,130,246,0.25); padding: 40px; text-align: center; margin-bottom: 20px; min-height: 200px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
  .capture-icon { width: 80px; height: 80px; border-radius: 50%; background: var(--accent-glow); display: flex; align-items: center; justify-content: center; margin-bottom: 16px; }
  .field-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; border-bottom: 1px solid var(--border); }
  .field-row:last-child { border-bottom: none; }
  .field-row.review { background: var(--warning-bg); }

  /* Fallback tracker */
  .fallback-center { max-width: 600px; margin: 0 auto; }
  .stepper { position: relative; padding-left: 40px; }
  .stepper-line { position: absolute; left: 15px; top: 20px; bottom: 20px; width: 2px; background: var(--border); }
  .step-item { position: relative; margin-bottom: 28px; transition: opacity 0.4s; }
  .step-item:last-child { margin-bottom: 0; }
  .step-dot { position: absolute; left: -40px; top: 2px; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1; }

  /* Modal */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(4px); }
  .modal { background: var(--surface); border-radius: 20px; border: 1px solid var(--border); padding: 32px; width: 520px; max-height: 80vh; overflow-y: auto; }
  .form-label { display: block; font-size: 12px; font-weight: 600; color: var(--text-muted); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.04em; }
  .form-input { width: 100%; background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px; color: var(--text); font-size: 14px; font-family: var(--font); outline: none; }
  textarea.form-input { resize: vertical; }

  /* Animations */
  @keyframes spin { to { transform: rotate(360deg); } }
  @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }
  .spinner { width: 64px; height: 64px; border-radius: 50%; border: 3px solid var(--accent); border-top-color: transparent; animation: spin 0.8s linear infinite; margin: 0 auto 20px; }
  .pulse-dot { width: 10px; height: 10px; border-radius: 50%; animation: pulse 1.5s infinite; }

  .hidden { display: none !important; }
</style>
</head>
<body>

<!-- SVG Icon defs -->
<svg style="display:none" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <symbol id="i-dashboard" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></symbol>
    <symbol id="i-benefits" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></symbol>
    <symbol id="i-preauth" viewBox="0 0 24 24"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/><path d="M9 14l2 2 4-4"/></symbol>
    <symbol id="i-cost" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></symbol>
    <symbol id="i-camera" viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></symbol>
    <symbol id="i-refresh" viewBox="0 0 24 24"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></symbol>
    <symbol id="i-search" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></symbol>
    <symbol id="i-check" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></symbol>
    <symbol id="i-x" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></symbol>
    <symbol id="i-alert" viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></symbol>
    <symbol id="i-clock" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></symbol>
    <symbol id="i-zap" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></symbol>
    <symbol id="i-phone" viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.13.88.37 1.73.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c1.08.33 1.93.57 2.81.7A2 2 0 0 1 22 16.92z"/></symbol>
    <symbol id="i-patient" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></symbol>
    <symbol id="i-shield" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></symbol>
    <symbol id="i-upload" viewBox="0 0 24 24"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></symbol>
    <symbol id="i-star" viewBox="0 0 24 24"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></symbol>
  </defs>
</svg>

<!-- Sidebar -->
<div class="sidebar">
  <div class="logo">
    <div class="logo-icon"><svg width="18" height="18"><use href="#i-shield" stroke="#fff" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
    <div><div class="logo-text">DentalVerify</div><div class="logo-sub">POC PROTOTYPE</div></div>
  </div>
  <div class="nav-label">Screens</div>
  <div id="nav"></div>
  <div style="flex:1"></div>
  <div class="sidebar-footer">Interactive prototype — click through all screens to explore the full verification flow.</div>
</div>

<!-- Main -->
<div class="main">
  <div class="main-inner">
    <div class="breadcrumb" id="breadcrumb"></div>
    <h1 class="page-title" id="page-title"></h1>
    <div id="screen-content"></div>
  </div>
</div>

<script>
// ─── Helpers ───
function icon(name, size=18, color='var(--text-muted)') {
  return `<svg width="${size}" height="${size}" style="flex-shrink:0"><use href="#i-${name}" stroke="${color}" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
}
function badge(text, color='var(--accent)', sm=false) {
  return `<span class="badge${sm?' sm':''}" style="color:${color};background:${color}18">${text}</span>`;
}
function statusDot(status) {
  const m = {verified:{c:'var(--success)',l:'Verified'},pending:{c:'var(--warning)',l:'Pending'},failed:{c:'var(--danger)',l:'Failed'},inProgress:{c:'var(--accent)',l:'In Progress'},expired:{c:'var(--text-dim)',l:'Expired'}};
  const s = m[status]||m.pending;
  return `<div class="status-dot"><div class="dot" style="background:${s.c};box-shadow:0 0 6px ${s.c}66"></div><span style="color:${s.c}">${s.l}</span></div>`;
}
function methodBadge(method) {
  const m = {edi:{i:'zap',c:'var(--success)',l:'EDI'},voice:{i:'phone',c:'var(--purple)',l:'AI Voice'},portal:{i:'search',c:'var(--cyan)',l:'Portal'},human:{i:'patient',c:'var(--warning)',l:'Human'}};
  const v = m[method]||m.edi;
  return badge(`${icon(v.i,11,v.c)} ${v.l}`, v.c, true);
}
function progressBar(value, max, color='var(--accent)', label='', showAmt=true) {
  const pct = Math.min((value/max)*100,100);
  const barColor = pct>80?'var(--danger)':pct>60?'var(--warning)':color;
  return `<div class="progress-wrap">
    ${label?`<div class="progress-label"><span style="color:var(--text-muted)">${label}</span>${showAmt?`<span style="color:var(--text);font-family:var(--mono);font-weight:600">$${value.toLocaleString()} / $${max.toLocaleString()}</span>`:''}</div>`:''}
    <div class="progress-bar"><div class="progress-fill" style="width:${pct}%;background:linear-gradient(90deg,${barColor},${barColor}cc)"></div></div>
  </div>`;
}

// ─── Data ───
const PATIENTS = [
  {id:1,name:"Sarah Chen",dob:"03/15/1988",appt:"Feb 12, 9:00 AM",procedure:"D2740 Crown",carrier:"Delta Dental PPO",status:"verified",method:"edi",memberId:"DDC889012345",group:"GRP-4421",maxUsed:450,maxTotal:1500,dedMet:50,dedTotal:100,preventive:100,basic:80,major:50,ortho:0,lastVerified:"Feb 10, 2:15 PM"},
  {id:2,name:"Marcus Johnson",dob:"07/22/1975",appt:"Feb 12, 10:30 AM",procedure:"D1110 Prophylaxis",carrier:"UnitedHealthcare",status:"pending",method:"portal",memberId:"UHC776543210",group:"GRP-8830",maxUsed:200,maxTotal:2000,dedMet:0,dedTotal:50,preventive:100,basic:80,major:50,ortho:50,lastVerified:"—"},
  {id:3,name:"Emily Rodriguez",dob:"11/03/1992",appt:"Feb 12, 1:00 PM",procedure:"D7210 Extraction",carrier:"Cigna DPPO",status:"failed",method:"voice",memberId:"CGN554321098",group:"GRP-1192",maxUsed:1100,maxTotal:1500,dedMet:100,dedTotal:100,preventive:100,basic:80,major:50,ortho:0,lastVerified:"Feb 9, 4:30 PM"},
  {id:4,name:"David Kim",dob:"01/30/2001",appt:"Feb 12, 2:30 PM",procedure:"D0120 Periodic Exam",carrier:"Aetna DMO",status:"verified",method:"edi",memberId:"AET332109876",group:"GRP-5567",maxUsed:0,maxTotal:1000,dedMet:0,dedTotal:75,preventive:100,basic:70,major:50,ortho:50,lastVerified:"Feb 11, 8:02 AM"},
  {id:5,name:"Lisa Thompson",dob:"05/18/1965",appt:"Feb 13, 9:30 AM",procedure:"D4341 Perio SRP",carrier:"BCBS PPO",status:"inProgress",method:"voice",memberId:"BCB110987654",group:"GRP-2244",maxUsed:750,maxTotal:2000,dedMet:50,dedTotal:50,preventive:100,basic:80,major:50,ortho:0,lastVerified:"—"},
  {id:6,name:"James Wilson",dob:"09/07/1980",appt:"Feb 13, 11:00 AM",procedure:"D2750 Crown PFM",carrier:"MetLife DPPO",status:"verified",method:"human",memberId:"MET998765432",group:"GRP-7713",maxUsed:300,maxTotal:1500,dedMet:100,dedTotal:100,preventive:100,basic:80,major:50,ortho:0,lastVerified:"Feb 10, 11:45 AM"},
];
const PREAUTHS = [
  {id:"PA-2024-001",patient:"Sarah Chen",procedure:"D2740 Crown - Porcelain",submitted:"Feb 5",status:"approved",payer:"Delta Dental",ref:"DD-AUTH-88921",est:"$720"},
  {id:"PA-2024-002",patient:"Emily Rodriguez",procedure:"D7210 Surgical Extraction",submitted:"Feb 8",status:"pending",payer:"Cigna",ref:"—",est:"$185"},
  {id:"PA-2024-003",patient:"Lisa Thompson",procedure:"D4341 SRP (4 quads)",submitted:"Feb 3",status:"moreInfo",payer:"BCBS",ref:"—",est:"$480"},
  {id:"PA-2024-004",patient:"James Wilson",procedure:"D2750 Crown PFM",submitted:"Feb 1",status:"approved",payer:"MetLife",ref:"ML-AUTH-55412",est:"$650"},
  {id:"PA-2024-005",patient:"David Kim",procedure:"D8080 Ortho Comprehensive",submitted:"Jan 28",status:"denied",payer:"Aetna",ref:"AE-DEN-33201",est:"$0"},
];

// ─── App State ───
const screens = [
  {key:'dashboard',label:'Verification Queue',icon:'dashboard',persona:'Front Desk'},
  {key:'benefits',label:'Benefits Detail',icon:'benefits',persona:'Front Desk'},
  {key:'preauth',label:'Preauthorizations',icon:'preauth',persona:'Provider'},
  {key:'estimate',label:'Cost Estimate',icon:'cost',persona:'Patient'},
  {key:'capture',label:'Card Capture',icon:'camera',persona:'Patient'},
  {key:'fallback',label:'Fallback Tracker',icon:'refresh',persona:'System'},
];
let state = { screen:'dashboard', patient: PATIENTS[0], filter:'all', search:'', benefitsTab:'overview', captureStep:0, selectedPlan:0, showModal:false };

function navigate(screen, extra={}) {
  Object.assign(state, {screen}, extra);
  render();
}

// ─── Nav ───
function renderNav() {
  document.getElementById('nav').innerHTML = screens.map(s =>
    `<button class="nav-btn ${state.screen===s.key?'active':''}" onclick="navigate('${s.key}'${s.key==='benefits'?`,{patient:state.patient||PATIENTS[0]}`:''})">
      ${icon(s.icon,16,state.screen===s.key?'var(--accent)':'var(--text-dim)')}
      <div style="flex:1"><div>${s.label}</div><div class="persona">${s.persona}</div></div>
    </button>`
  ).join('');
}

// ─── Screen: Dashboard ───
function renderDashboard() {
  const counts = {all:PATIENTS.length,verified:PATIENTS.filter(p=>p.status==='verified').length,pending:PATIENTS.filter(p=>p.status==='pending').length,inProgress:PATIENTS.filter(p=>p.status==='inProgress').length,failed:PATIENTS.filter(p=>p.status==='failed').length};
  const statsData = [{key:'all',label:'Total',count:counts.all,color:'var(--accent)'},{key:'verified',label:'Verified',count:counts.verified,color:'var(--success)'},{key:'pending',label:'Pending',count:counts.pending,color:'var(--warning)'},{key:'inProgress',label:'In Progress',count:counts.inProgress,color:'var(--cyan)'},{key:'failed',label:'Failed',count:counts.failed,color:'var(--danger)'}];
  const filtered = PATIENTS.filter(p => {
    if (state.filter!=='all' && p.status!==state.filter) return false;
    if (state.search && !p.name.toLowerCase().includes(state.search.toLowerCase())) return false;
    return true;
  });
  return `
    <div class="stats-grid">${statsData.map(s=>`
      <div class="stat-card${state.filter===s.key?' active':''}" style="${state.filter===s.key?`background:${s.color}18;border-color:${s.color}44`:''}" onclick="state.filter='${s.key}';render()">
        <div class="stat-num" style="color:${s.color}">${s.count}</div>
        <div class="stat-label">${s.label}</div>
      </div>`).join('')}
    </div>
    <div class="search-bar">
      <div class="search-input">${icon('search',16)}<input placeholder="Search patients..." value="${state.search}" oninput="state.search=this.value;render()"></div>
      <button class="btn-primary">${icon('refresh',15,'#fff')} Verify All</button>
    </div>
    <div class="data-table"><table>
      <thead><tr>${['Patient','Appointment','Procedure','Carrier','Status','Method','Actions'].map(h=>`<th>${h}</th>`).join('')}</tr></thead>
      <tbody>${filtered.map(p=>`
        <tr onclick="navigate('benefits',{patient:PATIENTS[${PATIENTS.indexOf(p)}]})">
          <td><div style="font-weight:600;font-size:14px;color:var(--text)">${p.name}</div><div style="font-size:12px;color:var(--text-dim);margin-top:2px">DOB: ${p.dob}</div></td>
          <td style="color:var(--text-muted)">${p.appt}</td>
          <td><code class="code-tag" style="color:var(--cyan);background:var(--cyan-bg)">${p.procedure}</code></td>
          <td style="color:var(--text-muted)">${p.carrier}</td>
          <td>${statusDot(p.status)}</td>
          <td>${methodBadge(p.method)}</td>
          <td><button style="background:var(--accent-glow);border:1px solid rgba(59,130,246,0.2);border-radius:8px;padding:6px 14px;color:var(--accent);font-size:12px;font-weight:600;cursor:pointer;font-family:var(--font)">View</button></td>
        </tr>`).join('')}
      </tbody>
    </table></div>`;
}

// ─── Screen: Benefits ───
function renderBenefits() {
  const p = state.patient || PATIENTS[0];
  const tab = state.benefitsTab || 'overview';
  const covRows = [
    {cat:'Preventive & Diagnostic',pct:p.preventive,ded:false,wait:null,freq:'2 exams, 2 cleanings, 1 FMX / 3yr'},
    {cat:'Basic Restorative',pct:p.basic,ded:true,wait:null,freq:'Amalgam/composite once per surface / 2yr'},
    {cat:'Major Restorative',pct:p.major,ded:true,wait:'12 mo',freq:'Crowns once / 5yr per tooth'},
    {cat:'Orthodontics',pct:p.ortho,ded:true,wait:p.ortho?'24 mo':null,freq:p.ortho?'$1,500 lifetime max':'Not covered'},
    {cat:'Endodontics',pct:p.basic,ded:true,wait:null,freq:'Root canal once per tooth / lifetime'},
    {cat:'Periodontics',pct:p.basic,ded:true,wait:null,freq:'SRP once / 24 months per quad'},
  ];
  const procs = [
    {code:'D0120',desc:'Periodic Oral Evaluation',cov:'100%',pa:false,fee:'$52',allowed:'$45',ins:'$45',patient:'$0'},
    {code:'D0274',desc:'Bitewings - Four Films',cov:'100%',pa:false,fee:'$72',allowed:'$62',ins:'$62',patient:'$0'},
    {code:'D1110',desc:'Prophylaxis - Adult',cov:'100%',pa:false,fee:'$110',allowed:'$95',ins:'$95',patient:'$0'},
    {code:'D2740',desc:'Crown - Porcelain/Ceramic',cov:'50%',pa:true,fee:'$1,400',allowed:'$1,200',ins:'$600',patient:'$600'},
    {code:'D7210',desc:'Surgical Extraction',cov:'80%',pa:true,fee:'$350',allowed:'$290',ins:'$232',patient:'$58'},
  ];
  const notes = [
    {type:'warning',text:'Missing tooth clause: Teeth missing before effective date are not covered for fixed prosthodontics.'},
    {type:'info',text:'Alternate benefit: Composite restorations on posterior teeth will be covered at the amalgam fee.'},
    {type:'warning',text:'Crown downgrade: PFM fee schedule applies to all-ceramic crowns on posterior teeth.'},
    {type:'info',text:'Coordination of Benefits: This plan is primary. Standard COB rules apply.'},
    {type:'danger',text:'Payer note: "Implant services excluded under this plan. No exceptions."'},
  ];

  function covColor(pct) { return pct>=80?'var(--success)':pct>=50?'var(--warning)':'var(--danger)'; }

  let tabContent = '';
  if (tab === 'overview') {
    tabContent = `<div class="card" style="padding:8px 20px 20px">
      <div class="cov-grid cov-header">${['Category','Coverage','Deductible','Wait','Frequency'].map(h=>`<span>${h}</span>`).join('')}</div>
      ${covRows.map(r=>`<div class="cov-grid">
        <span style="font-weight:600;font-size:14px;color:var(--text)">${r.cat}</span>
        <div style="display:flex;align-items:center;gap:6px">
          <div style="width:40px;height:6px;border-radius:3px;background:var(--border);overflow:hidden"><div style="width:${r.pct}%;height:100%;border-radius:3px;background:${covColor(r.pct)}"></div></div>
          <span style="font-size:13px;font-family:var(--mono);font-weight:700;color:${covColor(r.pct)}">${r.pct}%</span>
        </div>
        <span style="font-size:12px;color:var(--text-muted)">${r.ded?'Yes':'No'}</span>
        <span style="font-size:12px;color:${r.wait?'var(--warning)':'var(--success)'}">${r.wait||'None'}</span>
        <span style="font-size:12px;color:var(--text-dim)">${r.freq}</span>
      </div>`).join('')}
    </div>`;
  } else if (tab === 'procedures') {
    tabContent = `<div class="card" style="padding:8px 20px 20px">
      <div class="proc-grid proc-header">${['Code','Procedure','Coverage','PA','Fee','Allowed','Ins Pays','Patient'].map(h=>`<span style="font-size:11px;font-weight:700;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.06em">${h}</span>`).join('')}</div>
      ${procs.map(pr=>`<div class="proc-grid">
        <code style="font-size:12px;font-family:var(--mono);color:var(--cyan)">${pr.code}</code>
        <span style="font-size:13px;color:var(--text)">${pr.desc}</span>
        ${badge(pr.cov, covColor(parseInt(pr.cov)), true)}
        ${pr.pa?badge('PA','var(--purple)',true):'<span></span>'}
        <span style="font-size:12px;font-family:var(--mono);color:var(--text-dim)">${pr.fee}</span>
        <span style="font-size:12px;font-family:var(--mono);color:var(--text-muted)">${pr.allowed}</span>
        <span style="font-size:12px;font-family:var(--mono);color:var(--success)">${pr.ins}</span>
        <span style="font-size:12px;font-family:var(--mono);color:var(--warning);font-weight:700">${pr.patient}</span>
      </div>`).join('')}
    </div>`;
  } else {
    tabContent = `<div class="card" style="display:flex;flex-direction:column;gap:14px">
      ${notes.map(n=>{
        const c = n.type==='danger'?'var(--danger)':n.type==='warning'?'var(--warning)':'var(--accent)';
        const bg = n.type==='danger'?'var(--danger-bg)':n.type==='warning'?'var(--warning-bg)':'var(--accent-glow)';
        return `<div class="alert-note" style="background:${bg};border:1px solid ${c}22">${icon('alert',16,c)}<span style="color:var(--text)">${n.text}</span></div>`;
      }).join('')}
    </div>`;
  }

  const remaining = p.maxTotal - p.maxUsed;
  const dedRemaining = p.dedTotal - p.dedMet;

  return `
    <button onclick="navigate('dashboard')" style="display:flex;align-items:center;gap:6px;background:none;border:none;color:var(--accent);font-size:13px;cursor:pointer;margin-bottom:20px;font-family:var(--font);font-weight:600;padding:0">← Back to Queue</button>
    <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px">
      <div>
        <h2 style="font-size:24px;font-weight:700">${p.name}</h2>
        <div style="font-size:13px;color:var(--text-muted);margin-top:4px">${p.carrier} • Member ID: <span style="font-family:var(--mono);color:var(--cyan)">${p.memberId}</span> • Group: ${p.group}</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">${statusDot(p.status)} ${methodBadge(p.method)}</div>
    </div>
    <div class="cards-3">
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px">
          <div class="card-icon" style="background:var(--accent-glow)">${icon('shield',16,'var(--accent)')}</div>
          <span style="font-size:13px;font-weight:600;color:var(--text-muted)">Plan Details</span>
        </div>
        <div style="font-size:13px;line-height:2">Type: <strong>PPO</strong><br>Effective: <strong>01/01/2024</strong><br>Term: <strong>12/31/2025</strong><br>Year Type: <strong>Calendar</strong></div>
      </div>
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px">
          <div class="card-icon" style="background:var(--success-bg)">${icon('cost',16,'var(--success)')}</div>
          <span style="font-size:13px;font-weight:600;color:var(--text-muted)">Annual Maximum</span>
        </div>
        ${progressBar(p.maxUsed, p.maxTotal, 'var(--success)', 'Used')}
        <div style="margin-top:10px;font-size:13px;color:var(--success);font-weight:700;font-family:var(--mono)">$${remaining.toLocaleString()} remaining</div>
      </div>
      <div class="card">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px">
          <div class="card-icon" style="background:var(--purple-bg)">${icon('star',16,'var(--purple)')}</div>
          <span style="font-size:13px;font-weight:600;color:var(--text-muted)">Deductible</span>
        </div>
        ${progressBar(p.dedMet, p.dedTotal, 'var(--purple)', 'Met')}
        <div style="margin-top:10px;font-size:13px;color:${p.dedMet>=p.dedTotal?'var(--success)':'var(--purple)'};font-weight:700;font-family:var(--mono)">${p.dedMet>=p.dedTotal?'✓ Fully met':`$${dedRemaining} remaining`}</div>
      </div>
    </div>
    <div class="tabs">
      ${['overview','procedures','limitations'].map(t=>{
        const labels = {overview:'Coverage Summary',procedures:'Procedure Detail',limitations:'Limitations & Notes'};
        return `<button class="tab-btn${tab===t?' active':''}" onclick="state.benefitsTab='${t}';render()">${labels[t]}</button>`;
      }).join('')}
    </div>
    ${tabContent}
    <div style="margin-top:16px;display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--surface);border-radius:10px;border:1px solid var(--border)">
      <div style="display:flex;gap:16px;font-size:12px;color:var(--text-dim)">
        <span>Last verified: <strong style="color:var(--text-muted)">${p.lastVerified}</strong></span>
        <span>Source: ${methodBadge(p.method)}</span>
        <span>Confidence: ${badge('High','var(--success)',true)}</span>
      </div>
      <button class="btn-outline">${icon('refresh',13,'var(--accent)')} Re-verify</button>
    </div>`;
}

// ─── Screen: Preauth ───
function renderPreauth() {
  const stMap = {approved:{c:'var(--success)',l:'Approved',i:'check'},pending:{c:'var(--warning)',l:'Pending Review',i:'clock'},moreInfo:{c:'var(--purple)',l:'More Info Needed',i:'alert'},denied:{c:'var(--danger)',l:'Denied',i:'x'}};
  const cols = [{l:'Pending',c:'var(--warning)',items:PREAUTHS.filter(p=>p.status==='pending')},{l:'Info Needed',c:'var(--purple)',items:PREAUTHS.filter(p=>p.status==='moreInfo')},{l:'Approved',c:'var(--success)',items:PREAUTHS.filter(p=>p.status==='approved')},{l:'Denied',c:'var(--danger)',items:PREAUTHS.filter(p=>p.status==='denied')}];

  return `
    ${state.showModal?`<div class="modal-overlay" onclick="state.showModal=false;render()">
      <div class="modal" onclick="event.stopPropagation()">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
          <h3 style="font-size:20px;font-weight:700">New Preauthorization</h3>
          <button onclick="state.showModal=false;render()" style="background:none;border:none;cursor:pointer">${icon('x',20,'var(--text-muted)')}</button>
        </div>
        ${[{l:'Patient',ph:'Search patient...'},{l:'Insurance Plan',ph:'Select plan...'},{l:'CDT Code',ph:'e.g., D2740'},{l:'Procedure Description',ph:'Crown - Porcelain/Ceramic'},{l:'Tooth #',ph:'e.g., 14'}].map(f=>`<div style="margin-bottom:16px"><label class="form-label">${f.l}</label><input class="form-input" placeholder="${f.ph}"></div>`).join('')}
        <div style="margin-bottom:16px"><label class="form-label">Clinical Notes</label><textarea class="form-input" rows="3" placeholder="Describe medical necessity..."></textarea></div>
        <div style="display:flex;gap:10px;margin-top:8px">
          <button class="btn-primary" style="flex:1;padding:14px;border-radius:10px;font-size:14px;font-weight:700;justify-content:center">Submit Preauthorization</button>
          <button onclick="state.showModal=false;render()" style="padding:14px 24px;border-radius:10px;border:1px solid var(--border);background:var(--bg);color:var(--text-muted);font-weight:600;font-size:14px;cursor:pointer;font-family:var(--font)">Cancel</button>
        </div>
      </div>
    </div>`:''}
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
      <div><h3 style="font-size:18px;font-weight:700">Preauthorization Tracking</h3><p style="margin-top:4px;font-size:13px;color:var(--text-dim)">Submit, track, and manage prior authorizations</p></div>
      <button class="btn-primary" style="padding:10px 20px;border-radius:10px" onclick="state.showModal=true;render()">+ New Preauth</button>
    </div>
    <div class="kanban">${cols.map(col=>`
      <div class="kanban-col">
        <div class="kanban-header" style="border-bottom:2px solid ${col.c}33">
          <span style="font-size:13px;font-weight:700;color:${col.c}">${col.l}</span>
          <div class="count-bubble" style="background:${col.c}22;color:${col.c}">${col.items.length}</div>
        </div>
        <div class="kanban-body">${col.items.map(pa=>`
          <div class="kanban-card">
            <div style="font-size:13px;font-weight:600;color:var(--text);margin-bottom:4px">${pa.patient}</div>
            <code style="font-size:11px;font-family:var(--mono);color:var(--cyan)">${pa.procedure}</code>
            <div style="display:flex;justify-content:space-between;margin-top:8px">
              <span style="font-size:11px;color:var(--text-dim)">${pa.submitted}</span>
              <span style="font-size:12px;font-family:var(--mono);color:var(--success);font-weight:600">${pa.est}</span>
            </div>
          </div>`).join('')}
        </div>
      </div>`).join('')}
    </div>
    <div class="data-table"><table>
      <thead><tr>${['ID','Patient','Procedure','Payer','Submitted','Status','Ref #','Est. Coverage'].map(h=>`<th>${h}</th>`).join('')}</tr></thead>
      <tbody>${PREAUTHS.map(pa=>{const st=stMap[pa.status];return `
        <tr>
          <td><code style="font-size:12px;font-family:var(--mono);color:var(--text-dim)">${pa.id}</code></td>
          <td style="font-weight:600;color:var(--text)">${pa.patient}</td>
          <td><code style="font-size:11px;font-family:var(--mono);color:var(--cyan)">${pa.procedure}</code></td>
          <td style="color:var(--text-muted)">${pa.payer}</td>
          <td style="color:var(--text-dim)">${pa.submitted}</td>
          <td>${badge(`${icon(st.i,11,st.c)} ${st.l}`,st.c)}</td>
          <td><code style="font-size:11px;font-family:var(--mono);color:${pa.ref==='—'?'var(--text-dim)':'var(--text)'}">${pa.ref}</code></td>
          <td style="font-family:var(--mono);font-weight:700;color:var(--success)">${pa.est}</td>
        </tr>`;}).join('')}
      </tbody>
    </table></div>`;
}

// ─── Screen: Cost Estimate ───
function renderEstimate() {
  const sel = state.selectedPlan || 0;
  const plans = [{label:'With Insurance',cost:658,ins:1137,total:1795},{label:'Self-Pay Discount',cost:1436,ins:0,total:1436}];
  const procs = [
    {name:'Comprehensive Exam',fee:85,cov:85,pat:0},{name:'Bitewing X-rays (4)',fee:72,cov:72,pat:0},
    {name:'Teeth Cleaning',fee:138,cov:138,pat:0},{name:'Porcelain Crown (#14)',fee:1400,cov:742,pat:658},
    {name:'Consultation',fee:100,cov:100,pat:0},
  ];
  const pl = plans[sel];
  const payOpts = [
    {l:'Pay in Full',d:'Due at time of service',a:`$${pl.cost}`,h:false},
    {l:'3 Monthly Payments',d:'0% interest',a:`$${Math.round(pl.cost/3)}/mo`,h:true},
    {l:'6 Monthly Payments',d:'4.9% APR',a:`$${Math.round(pl.cost/6*1.025)}/mo`,h:false},
  ];
  return `<div class="estimate-center">
    <div class="estimate-header">
      <div class="avatar">SC</div>
      <h2 style="font-size:22px;font-weight:700">Your Treatment Estimate</h2>
      <p style="margin-top:8px;font-size:14px;color:var(--text-muted)">Sarah Chen • Delta Dental PPO</p>
      <div style="margin-top:16px;display:flex;justify-content:center;gap:6px">
        ${plans.map((p,i)=>`<button class="tab-btn${sel===i?' active':''}" onclick="state.selectedPlan=${i};render()">${p.label}</button>`).join('')}
      </div>
    </div>
    <div class="card" style="text-align:center;margin-bottom:20px;padding:28px">
      <div style="font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;font-weight:600">Your Estimated Cost</div>
      <div class="big-number">$${pl.cost.toLocaleString()}</div>
      ${sel===0?`<div style="margin-top:12px;font-size:14px;color:var(--success)">Insurance saves you <strong>$${pl.ins.toLocaleString()}</strong></div>`:`<div style="margin-top:12px;font-size:14px;color:var(--purple)">20% self-pay discount applied</div>`}
    </div>
    <div style="background:var(--surface);border-radius:16px;border:1px solid var(--border);overflow:hidden;margin-bottom:20px">
      <div style="padding:14px 20px;border-bottom:1px solid var(--border);font-size:13px;font-weight:700;color:var(--text-muted)">Treatment Breakdown</div>
      ${procs.map((pr,i)=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:14px 20px;${i<procs.length-1?'border-bottom:1px solid var(--border)':''}">
        <div>
          <div style="font-size:14px;font-weight:600;color:var(--text)">${pr.name}</div>
          <div style="font-size:12px;color:var(--text-dim);margin-top:2px">
            ${sel===0&&pr.pat===0?`<span style="color:var(--success)">Fully covered by insurance</span>`:sel===0?`Insurance pays $${pr.cov} • <span style="color:var(--warning)">You pay $${pr.pat}</span>`:`Fee: $${pr.fee}`}
          </div>
        </div>
        <div style="font-size:15px;font-family:var(--mono);font-weight:700;color:${sel===0&&pr.pat===0?'var(--success)':'var(--text)'}">
          ${sel===0?(pr.pat===0?'$0':`$${pr.pat}`):`$${Math.round(pr.fee*0.8)}`}
        </div>
      </div>`).join('')}
      <div style="display:flex;justify-content:space-between;padding:16px 20px;background:var(--bg);border-top:2px solid rgba(59,130,246,0.2)">
        <span style="font-size:15px;font-weight:700">Total Due</span>
        <span style="font-size:20px;font-weight:800;font-family:var(--mono);color:var(--accent)">$${pl.cost.toLocaleString()}</span>
      </div>
    </div>
    <div class="card" style="margin-bottom:20px">
      <div style="font-size:13px;font-weight:700;color:var(--text-muted);margin-bottom:14px">Payment Options</div>
      ${payOpts.map(o=>`<div class="payment-opt${o.h?' highlight':''}">
        <div><div style="font-size:14px;font-weight:600;color:var(--text)">${o.l}</div><div style="font-size:12px;color:var(--text-dim)">${o.d}</div></div>
        <div style="font-size:16px;font-weight:700;font-family:var(--mono);color:${o.h?'var(--accent)':'var(--text)'}">${o.a}</div>
      </div>`).join('')}
    </div>
    <button class="cta-btn">Accept & Schedule</button>
    <p style="text-align:center;font-size:12px;color:var(--text-dim);margin-top:12px">This is an estimate. Final costs may vary based on treatment complexity.</p>
  </div>`;
}

// ─── Screen: Card Capture ───
function renderCapture() {
  const step = state.captureStep || 0;
  const stepLabels = ['Capture Front','Capture Back','Processing','Confirm'];
  const bars = stepLabels.map((s,i)=>`<div class="step-bar"><div class="bar${i<=step?' active':''}"></div><span class="${i<=step?'active':''}">${s}</span></div>`).join('');

  if (step <= 1) {
    return `<div class="capture-center">
      <div class="step-progress">${bars}</div>
      <div class="capture-zone">
        <div class="capture-icon">${icon('camera',36,'var(--accent)')}</div>
        <div style="font-size:16px;font-weight:700;margin-bottom:8px">${step===0?'Scan Front of Card':'Scan Back of Card'}</div>
        <div style="font-size:13px;color:var(--text-muted);max-width:280px;line-height:1.5">Position the insurance card within the frame. The scan will start automatically.</div>
      </div>
      <div style="display:flex;gap:10px">
        <button class="btn-primary" style="flex:1;padding:14px;border-radius:12px;font-size:14px;font-weight:700;justify-content:center" onclick="state.captureStep=${step+1};render();${step===1?'setTimeout(()=>{state.captureStep=3;render()},2000)':''}">
          ${icon('camera',16,'#fff')} Capture Photo
        </button>
        <button style="padding:14px 20px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:var(--text-muted);font-weight:600;font-size:14px;cursor:pointer;font-family:var(--font)" onclick="state.captureStep=${step+1};render();${step===1?'setTimeout(()=>{state.captureStep=3;render()},2000)':''}">
          ${icon('upload',16,'var(--text-muted)')} Upload
        </button>
      </div>
    </div>`;
  }

  if (step === 2) {
    return `<div class="capture-center">
      <div class="step-progress">${bars}</div>
      <div style="text-align:center;padding:40px">
        <div class="spinner"></div>
        <div style="font-size:16px;font-weight:700">Processing Card...</div>
        <div style="font-size:13px;color:var(--text-muted);margin-top:8px">Extracting insurance information via OCR</div>
      </div>
    </div>`;
  }

  const fields = [
    {l:'Insurance Carrier',v:'Delta Dental',c:'high'},{l:'Plan Type',v:'PPO',c:'high'},
    {l:'Subscriber Name',v:'Sarah Chen',c:'high'},{l:'Member ID',v:'DDC889012345',c:'high'},
    {l:'Group Number',v:'GRP-4421',c:'high'},{l:'Payer ID',v:'DDCA1',c:'medium'},
    {l:'Effective Date',v:'01/01/2024',c:'high'},{l:'Copay - Preventive',v:'$0',c:'medium'},
  ];
  return `<div class="capture-center">
    <div class="step-progress">${bars}</div>
    <div style="background:var(--success-bg);border-radius:12px;padding:10px 16px;border:1px solid rgba(16,185,129,0.2);margin-bottom:20px;display:flex;align-items:center;gap:8px">
      ${icon('check',16,'var(--success)')}<span style="font-size:13px;color:var(--success);font-weight:600">All fields extracted with high confidence</span>
    </div>
    <div style="background:var(--surface);border-radius:14px;border:1px solid var(--border);overflow:hidden">
      ${fields.map(f=>`<div class="field-row${f.c==='medium'?' review':''}">
        <span style="font-size:12px;color:var(--text-muted);font-weight:600">${f.l}</span>
        <div style="display:flex;align-items:center;gap:8px">
          <code style="font-size:13px;font-family:var(--mono);color:var(--text);font-weight:600">${f.v}</code>
          ${f.c==='medium'?badge('Review','var(--warning)',true):''}
        </div>
      </div>`).join('')}
    </div>
    <div style="display:flex;gap:10px;margin-top:20px">
      <button style="flex:1;padding:14px;border-radius:12px;border:none;background:linear-gradient(135deg,var(--success),#059669);color:#fff;font-weight:700;font-size:14px;cursor:pointer;font-family:var(--font)">Confirm & Verify Eligibility</button>
      <button style="padding:14px 20px;border-radius:12px;border:1px solid var(--border);background:var(--surface);color:var(--text-muted);font-weight:600;font-size:14px;cursor:pointer;font-family:var(--font)" onclick="state.captureStep=0;render()">Re-scan</button>
    </div>
  </div>`;
}

// ─── Screen: Fallback Tracker ───
function renderFallback() {
  const steps = [
    {method:'edi',label:'EDI Electronic',status:'failed',time:'2:14:32 PM',detail:'Payer timeout — no 271 response after 30s'},
    {method:'portal',label:'Portal Automation',status:'failed',time:'2:14:48 PM',detail:'MFA required — cannot bypass CAPTCHA'},
    {method:'voice',label:'AI Voice Call',status:'inProgress',time:'2:15:01 PM',detail:'On hold with Delta Dental... Est. wait: 4 min'},
    {method:'human',label:'Human Fallback',status:'pending',time:'—',detail:'Queued — will trigger if voice call fails'},
  ];
  const activeStep = 2;
  return `<div class="fallback-center">
    <div class="card" style="padding:24px;margin-bottom:20px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <div>
          <div style="font-size:16px;font-weight:700">Verification Escalation</div>
          <div style="font-size:13px;color:var(--text-muted);margin-top:2px">Emily Rodriguez • Cigna DPPO</div>
        </div>
        ${badge(`${icon('clock',12,'var(--warning)')} In Progress`,'var(--warning)')}
      </div>
      <div class="stepper">
        <div class="stepper-line"></div>
        ${steps.map((s,i)=>{
          const isDone = i < activeStep;
          const isCurrent = i === activeStep;
          const dotColor = isDone?(s.status==='failed'?'var(--danger)':'var(--success)'):isCurrent?'var(--accent)':'var(--text-dim)';
          const dotInner = isDone&&s.status==='failed'?icon('x',14,dotColor):isDone?icon('check',14,dotColor):isCurrent?`<div class="pulse-dot" style="background:${dotColor}"></div>`:`<div style="width:8px;height:8px;border-radius:50%;background:var(--text-dim)"></div>`;
          const textColor = isDone&&s.status==='failed'?'var(--danger)':isCurrent?'var(--accent)':'var(--text-dim)';
          return `<div class="step-item" style="opacity:${i>activeStep?0.4:1}">
            <div class="step-dot" style="background:${dotColor}22;border:2px solid ${dotColor}">${dotInner}</div>
            <div>
              <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                ${methodBadge(s.method)}
                <span style="font-size:14px;font-weight:600;color:var(--text)">${s.label}</span>
                ${s.time!=='—'?`<span style="font-size:11px;color:var(--text-dim);font-family:var(--mono)">${s.time}</span>`:''}
              </div>
              <div style="font-size:13px;color:${textColor};line-height:1.4">${s.detail}</div>
            </div>
          </div>`;
        }).join('')}
      </div>
    </div>
    <div style="background:var(--accent-glow);border-radius:12px;padding:12px 16px;border:1px solid rgba(59,130,246,0.2);display:flex;align-items:center;gap:10px">
      ${icon('zap',16,'var(--accent)')}
      <span style="font-size:13px;color:var(--text-muted)">Automatic fallback ensures verification completes even when primary channels fail. Average resolution time: <strong style="color:var(--text)">8 minutes</strong></span>
    </div>
  </div>`;
}

// ─── Render ───
function render() {
  renderNav();
  const s = screens.find(x=>x.key===state.screen);
  document.getElementById('breadcrumb').innerHTML = `${badge(s.persona,'var(--purple)',true)} <span>→</span> <span>${s.label}</span>`;
  document.getElementById('page-title').textContent = s.label;

  const renderers = {dashboard:renderDashboard,benefits:renderBenefits,preauth:renderPreauth,estimate:renderEstimate,capture:renderCapture,fallback:renderFallback};
  document.getElementById('screen-content').innerHTML = renderers[state.screen]();
}

render();
</script>
</body>
</html>
